var gall=function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t){e.exports=class{constructor(e){this.css={image:"image",popupStat:"popup-stat",likeBtnActive:"like_active",dislikeBtnActive:"dislike_active",show:"show",showFlex:"show-flex"}}addEventsOnButtons(e,t,i){e.like.addEventListener("click",function(t){e.like.children[0].src="image/like-active.png",e.like.classList.add(`${this.css.likeBtnActive}`),e.dislike.classList.remove(`${this.css.dislikeBtnActive}`);let i=this.findDivElem(e.popupPic.src,this.css.image);-1==i.like?(document.querySelectorAll(`.${this.css.popupStat}`)[0].innerText=i.likeStat+1,document.querySelectorAll(`.${this.css.popupStat}`)[1].innerText=i.dislikeStat,e.dislike.children[0].src="image/dislike.png"):document.querySelectorAll(`.${this.css.popupStat}`)[0].innerText=i.likeStat+1,i.like=1}.bind(this)),e.dislike.addEventListener("click",function(t){e.dislike.children[0].src="image/dislike-active.png",e.dislike.classList.add(`${this.css.dislikeBtnActive}`),e.like.classList.remove(`${this.css.likeBtnActive}`);let i=this.findDivElem(e.popupPic.src,this.css.image);1==i.like?(document.querySelectorAll(`.${this.css.popupStat}`)[0].innerText=i.likeStat,document.querySelectorAll(`.${this.css.popupStat}`)[1].innerText=i.dislikeStat+1,e.like.children[0].src="image/like.png"):document.querySelectorAll(`.${this.css.popupStat}`)[1].innerText=i.dislikeStat+1,i.like=-1}.bind(this)),e.container.addEventListener("click",function(t){let i=window.innerWidth,s=window.innerHeight,n=t.target.src;t.target.className==this.css.image&&(e.popupBg.classList.add(`${this.css.show}`),e.popup.classList.add(`${this.css.showFlex}`),e.popup.style.left=(i-810)/2+"px",e.popup.style.top=(s-590)/2+"px",e.popup.children[0].children[0].src=n,this.refreshInfoForPopup(e.popup,e))}.bind(this)),window.addEventListener("click",function(t){if(t.target.classList.contains("close-btn")||t.target.classList.contains("popup-bg")){e.popupBg.classList.remove(`${this.css.show}`),e.popup.classList.remove(`${this.css.showFlex}`);try{this.clearInfo(e),this.standartLikeDislike(this.findDivElem(e.popupPic.src,this.css.image),e)}catch(t){console.log(t)}}}.bind(this)),e.formSubmit.addEventListener("click",function(){this.commentsRequest(t,i,e)}.bind(this))}refreshInfoForPopup(e,t){let i=e.children[0].children[0].src,s=this.findDivElem(i,this.css.image);if(s.imageData){this.clearInfo(t);let e=s.imageData.length;t.popupCommentStat.innerText=e,this.showComments(s.imageData,t),t.popupLikeStat.innerText=s.likeStat,t.popupDisikeStat.innerText=s.dislikeStat}}commentsRequest(e,t,i){let s=i.form.children[0].value,n=i.form.children[1].value;if(""==s||""==n)return alert("Enter your name or comment");let r=i.popupPic.src,o=this.findDivElem(r,this.css.image),c=void 0==o.like?0:o.like;i.form.children[0].value="",i.form.children[1].value="";let l=this.createStringDate(),a=JSON.stringify({[r]:{nick:s,comm:n,date:l,like:c}});o.imageData.push({nick:s,comm:n,date:l,like:c}),this.standartLikeDislike(o,i),e(a,function(e){try{i.commentsObj=JSON.parse(e.responseText),o.likeStat=i.popupLikeStat.innerText,o.dislikeStat=i.popupDisikeStat.innerText,this.refreshInfoForPopup(i.popup,i),t(o)}catch(e){console.log(e)}}.bind(this))}standartLikeDislike(e,t){t.dislike.classList.remove(`${this.css.dislikeBtnActive}`),t.like.classList.remove(`${this.css.likeBtnActive}`),t.dislike.children[0].src="image/dislike.png",t.like.children[0].src="image/like.png",e.like=0}showComments(e,t){let i=document.createElement("tr"),s=document.createElement("tr");for(let n=0;n<e.length;n++)i.innerHTML="<td><div></div></td><td><div></div></td>",i.children[0].children[0].innerText="By "+e[n].nick,i.children[1].children[0].innerText=e[n].date,i.className="inner-comment-above",s.innerHTML="<td colspan='2'><div></div></td>",s.children[0].children[0].innerText=e[n].comm,s.className="inner-comment",t.commentWindow.appendChild(i.cloneNode(!0)),t.commentWindow.appendChild(s.cloneNode(!0))}clearInfo(e){e.commentWindow.innerHTML="",e.popupCommentStat.innerText=0,e.popupLikeStat.innerText=0,e.popupDisikeStat.innerText=0}}},function(e,t){e.exports=class{constructor(e){this.gridMap=[],this.UND=void 0,this.cellWidth=236,this.cellHeight=200,this.rowNum=3,this.cellNum=9999,this.css={hoverElem:"hover-info",hoverInfoPics:"hover-info-pic-data",hoverComment:"hover-info__comment",hoverLike:"hover-info__like",hoverDislike:"hover-info__dislike",image:"image"}}setGridMapArr(){for(let e=0;e<this.rowNum;e++)this.gridMap.push(new Array(this.cellNum))}createImageElement(e){let t=document.createElement("div");t.className=this.css.hoverElem,t.innerHTML=`<div class="${this.css.hoverInfoPics} ${this.css.hoverComment}">`+'<img src="image/comment.png" alt=""><span class=\'statistics\'>0</span></div>'+`<div class="${this.css.hoverInfoPics} ${this.css.hoverLike}">`+'<img src="image/like.png" alt=""><span class=\'statistics\'>0</span></div>'+`<div class="${this.css.hoverInfoPics} ${this.css.hoverDislike}">`+'<img src="image/dislike.png" alt=""><span class=\'statistics\'>0</span></div>';let i=document.createElement("div");return i.className=this.css.image,i.appendChild(t),"h"==e?(i.style.width=this.cellWidth+"px",i.style.height=2*this.cellHeight+10+"px"):"w"==e?(i.style.width=2*this.cellWidth+10+"px",i.style.height=this.cellHeight+"px"):(i.style.width=this.cellWidth+"px",i.style.height=this.cellHeight+"px"),i}calcScale(e){let t=0,i=0;i=e.naturalHeight,(t=e.naturalWidth)/i>1.45?t>2*this.cellWidth&&(e.scale="w"):i/t>1.45?i>2*this.cellHeight&&(e.scale="h"):e.scale="n"}findFreeSpace(e){if("h"==e)for(let e=0;e<this.cellNum;e++){if(this.gridMap[0][e]==this.UND&&this.gridMap[1][e]==this.UND)return{x:0,y:e};if(this.gridMap[1][e]==this.UND&&this.gridMap[2][e]==this.UND)return{x:1,y:e}}else if("w"==e)for(let e=0;e<this.cellNum;e++){if(this.gridMap[0][e]==this.UND&&this.gridMap[0][e+1]==this.UND)return{x:0,y:e};if(this.gridMap[1][e]==this.UND&&this.gridMap[1][e+1]==this.UND)return{x:1,y:e};if(this.gridMap[2][e]==this.UND&&this.gridMap[2][e+1]==this.UND)return{x:2,y:e}}else for(let e=0;e<this.cellNum;e++){if(this.gridMap[0][e]==this.UND)return{x:0,y:e};if(this.gridMap[1][e]==this.UND)return{x:1,y:e};if(this.gridMap[2][e]==this.UND)return{x:2,y:e}}}position(e,t){let i=e.x,s=e.y;t.style.position="absolute",t.style.top=this.cellHeight*i+10*i+"px",t.style.left=this.cellWidth*s+10*s+"px"}insertData(e,t,i){i.commentsObj[t.src]?e.imageData=i.commentsObj[t.src]:e.imageData=[]}setImage(e,t){switch(this.calcScale(e),e.scale){case"h":let i=this.findFreeSpace("h"),s=this.createImageElement("h");return this.insertData(s,e,t),this.position(i,s),s.style.backgroundImage=`url(${e.src})`,s.src=e.src,this.refreshInfoForSingleImage(s),this.gridMap[i.x][i.y]=1,this.gridMap[i.x+1][i.y]=1,s;case"w":let n=this.findFreeSpace("w"),r=this.createImageElement("w");return this.insertData(r,e,t),this.position(n,r),r.style.backgroundImage=`url(${e.src})`,r.src=e.src,this.refreshInfoForSingleImage(r),this.gridMap[n.x][n.y]=1,this.gridMap[n.x][n.y+1]=1,r;default:let o=this.findFreeSpace("n"),c=this.createImageElement("s");return this.insertData(c,e,t),this.position(o,c),c.style.backgroundImage=`url(${e.src})`,c.src=e.src,this.refreshInfoForSingleImage(c),this.gridMap[o.x][o.y]=1,c}}setToGrid(e,t,i){var s=this;for(let n=0;n<i.pictureObj.length;n++)new Promise((e,t)=>{let s=new Image;s.src=i.pictureObj[n],s.onload=(()=>{e(s)})}).then(n=>{var r=s.setImage(n,i);i.container.appendChild(r),i.container.quantity++,t(r,i),i.container.quantity==i.pictureObj.length&&e&&e("done!")}).catch(e=>{console.log(e)})}refreshInfoForSingleImage(e,t){let i=e.children[0].children[0].children[1],s=e.children[0].children[2].children[1],n=e.children[0].children[1].children[1],r=0,o=0;if(e.imageData){let t=e.imageData.length;i.innerText=t;for(let t=0;t<e.imageData.length;t++)1==e.imageData[t].like?r++:-1==e.imageData[t].like&&o++;e.likeStat=r,e.dislikeStat=o,s.innerText=o,n.innerText=r}}}},function(e,t){e.exports=class{constructor(e){this.name="AJAX"}requestForPictures(e){return new Promise(function(e,t){var i=new XMLHttpRequest;i.open("POST","/pictureGet",!0),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.onload=function(){if(200!=i.status)throw new Error("Fail to execute request: "+i.status);try{e(i.responseText)}catch(e){console.log(e)}},i.send()}).then(t=>{e.pictureObj=JSON.parse(t)}).catch(e=>{console.log(e)})}requestForData(e){return new Promise(function(e,t){var i=new XMLHttpRequest;i.open("POST","/jsondata",!0),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.onload=function(){if(200!=i.status)throw new Error("Fail to execute request: "+i.status);try{e(i.responseText)}catch(e){console.log(e)}},i.send()}).then(t=>{e.commentsObj=JSON.parse(t)}).catch(e=>{console.log(e)})}sendComments(e,t){var i=new XMLHttpRequest;i.open("POST","/json",!0),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.onreadystatechange=function(){if(4==i.readyState)try{t(i)}catch(e){console.log(e)}},i.send(e)}}},function(e,t){e.exports=class e{static inherit(...t){class i{get base(){return t}constructor(...t){var i=0;for(let s of this.base){let n=new s(t[i++]);e.copy(this,n)}}}for(let s of t)e.copy(i,s),e.copy(i.prototype,s.prototype);return i}static copy(e,t){for(let i of Reflect.ownKeys(t))if("constructor"!==i&&"prototype"!==i&&"name"!==i){let s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,s)}}}},function(e,t,i){const s=i(3);let n=i(2),r=i(1),o=i(0);i(9);class c{constructor(e){this.commentsObj={},this.pictureObj=[],this.iconsObj=[]}findDivElem(e,t){let i=document.querySelectorAll(`.${t}`);for(let t=0;t<i.length;t++){if(i[t].style.backgroundImage.slice(5,-2)==e)return i[t]}}createStringDate(){let e=new Date,t=e.getDate()<10?"0"+e.getDate():e.getDate(),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,s=e.getHours()+1<10?"0"+e.getHours():e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();return e=t+"."+i+"."+e.getFullYear()+" "+s+":"+n}}c.container=document.querySelector(".image-gallery"),c.container.quantity=0,c.ico=document.querySelectorAll(".ico > img"),c.popup=document.querySelector(".popup"),c.close=document.getElementById("close-btn"),c.popupPic=document.getElementById("popup-pic"),c.popupBg=document.querySelector(".popup-bg"),c.like=document.querySelector(".like"),c.dislike=document.querySelector(".dislike"),c.commentWindow=document.querySelector(".comments-window"),c.uploadWindow=document.querySelector(".upload-pic"),c.popupLikeStat=document.querySelector(".popup-like-stat"),c.popupDisikeStat=document.querySelector(".popup-dislike-stat"),c.popupCommentStat=document.querySelector(".popup__comments-quantity"),c.form=document.querySelector(".send-comment"),c.formSubmit=document.querySelector(".send-comment button");let l=new class extends(s.inherit(n,c)){constructor(e){super()}},a=new class extends(s.inherit(r,c)){constructor(e){super()}},p=new class extends(s.inherit(o,c)){constructor(e){super()}};t.VariablesAndCommonFunctions=c,t.req=l,t.gridCreating=a,t.windowPopup=p,Promise.all([l.requestForPictures(c),l.requestForData(c)]).then(()=>{a.setGridMapArr(),a.setToGrid("",a.refreshInfoForSingleImage,c),p.addEventsOnButtons(c,l.sendComments,a.refreshInfoForSingleImage)}).catch(e=>{console.log(e)}),console.log("started")},,,,,function(e,t){}]);